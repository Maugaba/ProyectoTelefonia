<link href="../../../../../public/assets/css/pages/wizard/wizard-5.css" rel="stylesheet" type="text/css" />
<div class="d-flex flex-column flex-root">
  <!--begin::Page-->
  <div class="d-flex flex-row flex-column-fluid page">
    <!--begin::Wrapper-->
    <div class="d-flex flex-column flex-row-fluid wrapper" id="kt_wrapper">
      <!--begin::Header-->

      <!--end::Header-->

      <!--begin::Content-->
      <div class="content d-flex flex-column flex-column-fluid" id="kt_content">
        <!--begin::Subheader-->
        <div class="subheader py-2 py-lg-12 subheader-transparent" id="kt_subheader">
          <div class="container d-flex align-items-center justify-content-between flex-wrap flex-sm-nowrap">
            <div class="d-flex align-items-center flex-wrap mr-1">
              <div class="d-flex flex-column">
                <h2 class="text-white font-weight-bold my-2 mr-5">Venta</h2>
                <div class="d-flex align-items-center font-weight-bold my-2">
                  <a href="#" class="opacity-75 hover-opacity-100">
                    <i class="flaticon2-shelter text-white icon-1x"></i>
                  </a>
                  <span class="label label-dot label-sm bg-white opacity-75 mx-3"></span>
                  <a href="#" class="text-white text-hover-white opacity-75 hover-opacity-100">Nueva venta</a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--end::Subheader-->
        <!--begin::Entry-->
        <div class="d-flex flex-column-fluid">
          <!--begin::Container-->
          <div class="container">
            <!--begin::Page Layout-->
            <div class="d-flex flex-row">
              <!--begin::Layout-->
              <div class="flex-row-fluid ml-lg-8">
                <!--begin::Section-->
                <div class="card card-custom gutter-b">
                  <!--begin::Header-->
                  <div class="card-header flex-wrap border-0 pt-6 pb-0">
                    <h3 class="card-title align-items-start flex-column">
                      <span class="card-label font-weight-bolder font-size-h3 text-dark">Realizar una nueva venta</span>
                    </h3>
                  </div>
                  <!--end::Header-->
                  <div class="card-body">
                    <!--begin::Shopping Cart-->
                    <div class="table-responsive">
                      <form [formGroup]="salesForm" (ngSubmit)="onSubmit()">
                        <div class="form-row">
                          <div class="col">
                            <label class="font-size-h6 font-weight-bolder text-dark" id="txtLabel">Cliente*</label>
                            <select formControlName="customer_id" class="form-control h-auto p-5 border-0 rounded-lg font-size-h6 bg-gray-100">
                              <option *ngFor="let customer of customers" [value]="customer.id">{{ customer.name }}</option>
                            </select>
                          </div>
                          <div class="col">
                            <label class="font-size-h6 font-weight-bolder text-dark" id="txtLabel">Fecha *</label>
                            <input type="date" formControlName="sale_date" class="form-control h-auto p-5 border-0 rounded-lg font-size-h6 bg-gray-100" placeholder="Fecha de la venta">
                          </div>
                        </div>
                        <table class="table">
                          <!--begin::Cart Header-->
                          <thead>
                            <tr>
                              <th class="text-center">Producto</th>
                              <th class="text-center">Cantidad</th>
                              <th class="text-center">Precio Unitario</th>
                              <th class="text-center">Subtotal</th>
                              <th></th>
                            </tr>
                          </thead>
                          <!--end::Cart Header-->
                          <tbody formArrayName="items">
                            <tr *ngFor="let item of items.controls; let i = index" [formGroupName]="i">
                              <td style="width: 40%;">
                                <select formControlName="product_id" (change)="onProductSelect(i)" class="form-control h-auto p-5 border-0 rounded-lg font-size-h6 bg-gray-100">
                                  <option *ngFor="let product of products" [value]="product.id">{{ product.name }}</option>
                                </select>
                              </td>
                              <td class="text-center">
                                <input type="number" formControlName="quantity" (input)="updateTotalPrice(i)" class="form-control h-auto p-5 border-0 rounded-lg font-size-h6 bg-gray-100">
                              </td>
                              <td class="text-right">
                                <input type="text" formControlName="unit_price"  readonly class="form-control h-auto p-5 border-0 rounded-lg font-size-h6 bg-gray-100">
                              </td>
                              <td class="text-right">
                                <input type="text" formControlName="total_price" readonly class="form-control h-auto p-5 border-0 rounded-lg font-size-h6 bg-gray-100">
                              </td>
                              <td>
                                <button type="button" class="btn btn-danger font-weight-bolder font-size-sm" (click)="removeItem(i)">Eliminar</button>
                              </td>
                            </tr>
                            <tr>
                              <td colspan="5">
                                <button type="button" class="btn btn-primary font-weight-bolder font-size-sm" (click)="addItem()">Agregar Producto</button>
                              </td>
                            </tr>
                            <tr>
                              <td colspan="3" class="font-weight-bolder font-size-h4 text-right">Total</td>
                              <td colspan="1" class="font-weight-bolder font-size-h4 text-right">Q{{ salesForm.get('total_amount')?.value | number: '1.2-2' }}</td>
                            </tr>
                          </tbody>
                          <tr>
                            <td colspan="5" class="border-0 text-left pt-10">
                              <label class="font-size-h6 font-weight-bolder text-dark" id="txtLabel">Nota de la venta *</label>
                              <textarea formControlName="notes" class="form-control h-auto p-5 border-0 rounded-lg font-size-h6 bg-gray-100" placeholder="Nota adicional"></textarea>
                            </td>
                          </tr>
                          <tr>
                            <td colspan="4" class="border-0 text-right pt-10">
                              <button type="submit" class="btn btn-success font-weight-bolder px-8" >Realizar Venta</button>
                            </td>
                          </tr>
                        </table>
                      </form>
                    </div>
                    <!--end::Shopping Cart-->
                  </div>
                  
                </div>
                <!--end::Section-->
              </div>
              <!--end::Layout-->
            </div>
            <!--end::Page Layout-->
          </div>
          <!--end::Container-->
        </div>
        <!--end::Entry-->
      </div>
      <!--end::Content-->
    </div>
    <!--end::Wrapper-->
  </div>
  <!--end::Page-->
</div>
